

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>软件安装 &mdash; VMEDAQ 2019.12.28 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="固件要求" href="Firmware.html" />
    <link rel="prev" title="简介" href="README.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> VMEDAQ
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">简介</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">简介</a></li>
</ul>
<p class="caption"><span class="caption-text">安装</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">软件安装</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">系统要求</a></li>
<li class="toctree-l2"><a class="reference internal" href="#caen-lib">CAEN Lib</a></li>
<li class="toctree-l2"><a class="reference internal" href="#caenvmelib">检查CAENVMELib安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="#caenupgrader">检查CAENUpgrader安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v1718">V1718</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a2818">A2818驱动</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a3818">A3818驱动</a></li>
<li class="toctree-l2"><a class="reference internal" href="#riken-babirl">RIKEN babirl</a></li>
<li class="toctree-l2"><a class="reference internal" href="#babicon">初始化babicon</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">防火墙设置</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">固件</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Firmware.html">固件要求</a></li>
</ul>
<p class="caption"><span class="caption-text">配置</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Setting.html">获取配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="anaroot.html">anaroot</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkcnt.html">checkcnt</a></li>
<li class="toctree-l1"><a class="reference internal" href="cutpedo.html">cutpedestal</a></li>
<li class="toctree-l1"><a class="reference internal" href="DAQConfig.html">DAQConfig</a></li>
<li class="toctree-l1"><a class="reference internal" href="httponline.html">httponline</a></li>
<li class="toctree-l1"><a class="reference internal" href="online.html">online</a></li>
<li class="toctree-l1"><a class="reference internal" href="r2root.html">r2root</a></li>
<li class="toctree-l1"><a class="reference internal" href="statistics.html">statistics</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VMEDAQ</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>软件安装</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/INSTALL.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>软件安装<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<p>本页面安装软件放置在 source 文件夹内，里面包括 <strong>获取驱动、依赖库等以及自动安装脚本</strong> 。</p>
<div class="section" id="id2">
<h2>系统要求<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>本获取经过 Scientific Linux 6/7 系统测试。建议采用 CentOS 6/7 或者 Scientific Linux 6/7。</p>
<p>本获取要求 CERN ROOT 5/6，建议优先选择 ROOT 6。</p>
<p>如果没有合适的系统，可参考我们的获取系统安装 <a class="reference external" href="http://wuhongyi.cn/CodeProject/ScientisicLinux72.html">Install Scientific 7</a> 。安装好系统之后，还需要对基础依赖工具做一些安装及升级，可以下载执行 <a class="reference external" href="https://github.com/wuhongyi/BasicConfiguration">自动化安装脚本</a> 自动配置或者按照教程手动安装。</p>
</div>
<hr class="docutils" />
<div class="section" id="caen-lib">
<h2>CAEN Lib<a class="headerlink" href="#caen-lib" title="永久链接至标题">¶</a></h2>
<p>本程序依赖 CAENVMELib/CAENComm/CAENUpgrader 三个库文件。</p>
<p>其中 CAENVMELib/CAENComm 为获取运行必须的库。CAENUpgrader 用来更新固件。</p>
<p>进入 source 文件夹内，在 ROOT 权限下执行 setup.sh 脚本，将会自动安装以上三个依赖库。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 在 source 文件夹内，ROOT 权限下执行以下命令</span>
sh setup.sh    <span class="c1">#需要ROOT权限</span>
</pre></div>
</div>
</div>
<div class="section" id="caenvmelib">
<h2>检查CAENVMELib安装<a class="headerlink" href="#caenvmelib" title="永久链接至标题">¶</a></h2>
<p>进入 CheckRegisterToolByV2718 文件夹，make 编译里面程序，如果生成一个名为 pku 的可执行文件，则软件安装成功。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> CheckRegisterToolByV2718
make
</pre></div>
</div>
</div>
<div class="section" id="caenupgrader">
<h2>检查CAENUpgrader安装<a class="headerlink" href="#caenupgrader" title="永久链接至标题">¶</a></h2>
<p>安装后在终端中输入</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CAENUpgraderGUI
</pre></div>
</div>
<p>将会弹出 CAEN Upgrader GUI 的图形界面。</p>
</div>
<hr class="docutils" />
<div class="section" id="v1718">
<h2>V1718<a class="headerlink" href="#v1718" title="永久链接至标题">¶</a></h2>
<p>如果您使用 V1718，则需要安装 USB 驱动。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar -xzvf CAENUSBdrvB-1.5.2.tgz
<span class="nb">cd</span> CAENUSBdrvB-1.5.2
make
make install     <span class="c1">#需要ROOT权限</span>
</pre></div>
</div>
</div>
<div class="section" id="a2818">
<h2>A2818驱动<a class="headerlink" href="#a2818" title="永久链接至标题">¶</a></h2>
<p>如果您使用 A2818，则安装以下驱动。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># A2818Drv-1.20-build20161118.tgz</span>
<span class="c1">#将该文件夹复制到 /opt 并安装在该位置</span>
tar -zxvf A2818Drv-1.20-build20161118.tgz
cp -r A2818Drv-1.20 /opt           <span class="c1">#需要ROOT权限</span>
<span class="nb">cd</span> /opt/A2818Drv-1.20              <span class="c1">#需要ROOT权限</span>
cp ./Makefile.2.6-3.x Makefile     <span class="c1">#需要ROOT权限</span>
make                               <span class="c1">#需要ROOT权限</span>

<span class="c1">#设置开机自动执行该脚本</span>
<span class="c1">#在文件 /etc/rc.d/rc.local 中添加以下一行内容</span>
/bin/sh /opt/A2818Drv-1.20/a2818_load
<span class="c1">#或者在开启电脑之后执行以上命令</span>
</pre></div>
</div>
<p>重启机箱后，在终端内输入 <strong>dmesg|grep a2818</strong> 将会看到以下的 A2818 驱动加载信息</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>a2818: CAEN A2818 CONET controller driver v1.20s
a2818:   Copyright <span class="m">2004</span>, CAEN SpA
pci <span class="m">0000</span>:05:02.0: enabling device <span class="o">(</span><span class="m">0000</span> -&gt; <span class="m">0003</span><span class="o">)</span>
pci <span class="m">0000</span>:05:02.0: PCI INT A -&gt; GSI <span class="m">19</span> <span class="o">(</span>level, low<span class="o">)</span> -&gt; IRQ <span class="m">19</span>
a2818: found A2818 adapter at iomem 0xf7800000 irq <span class="m">0</span>, PLX at 0xf7900000
a2818:   CAEN A2818 Loaded.
a2818:   CAEN A2818: <span class="m">1</span> device<span class="o">(</span>s<span class="o">)</span> found.
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="a3818">
<h2>A3818驱动<a class="headerlink" href="#a3818" title="永久链接至标题">¶</a></h2>
<p>如果您使用 A3818，则安装以下驱动。安装该驱动时，电脑机箱必须插入 A3818 卡，否则将会报安装失败。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar -zxvf A3818Drv-1.6.1.tgz
<span class="nb">cd</span> A3818Drv-1.6.1
make
make install       <span class="c1">#需要ROOT权限</span>
</pre></div>
</div>
<p>然后在终端内输入 dmesg 将会看到以下的 A3818 驱动加载信息</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>fuse init <span class="o">(</span>API version <span class="m">7</span>.14<span class="o">)</span>
CAEN A3818 PCI Express CONET2 controller driver v1.6.0s
  Copyright <span class="m">2013</span>, CAEN SpA
pci <span class="m">0000</span>:02:00.0: PCI INT A -&gt; GSI <span class="m">16</span> <span class="o">(</span>level, low<span class="o">)</span> -&gt; IRQ <span class="m">16</span>
  alloc irq_desc <span class="k">for</span> <span class="m">33</span> on node -1
  alloc kstat_irqs on node -1
pci <span class="m">0000</span>:02:00.0: irq <span class="m">33</span> <span class="k">for</span> MSI/MSI-X
pci <span class="m">0000</span>:02:00.0: setting latency timer to <span class="m">64</span>
Found A3818 - Common BAR at iomem ffffc900067d4000 irq <span class="m">0</span>
Found A3818 with <span class="m">1</span> link<span class="o">(</span>s<span class="o">)</span>
found A3818 Link <span class="m">0</span> BAR at iomem ffffc900067d6000 irq <span class="m">0</span>
  CAEN A3818 Loaded.
  CAEN PCIe: <span class="m">1</span> device<span class="o">(</span>s<span class="o">)</span> found.
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="riken-babirl">
<h2>RIKEN babirl<a class="headerlink" href="#riken-babirl" title="永久链接至标题">¶</a></h2>
<p>babirl自动化安装方法</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#在个人用户目录下安装理研 babirl 库</span>
<span class="c1">#在普通权限下执行以下脚本</span>
sh autoinstallbabirl.sh
</pre></div>
</div>
<p>安装脚本会自动添加环境变量
安装结束后查看 .bashrc 文件，最后将多了三行如下内容</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/home/wuhongyi/babirl/bin/
<span class="nb">export</span> <span class="nv">TARTSYS</span><span class="o">=</span>/home/wuhongyi/VMEDAQ/anaroot
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:<span class="nv">$TARTSYS</span>/lib:<span class="nv">$TARTSYS</span>/sources/Core
<span class="c1">#其中 wuhongyi 为电脑当前用户名</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#在ROOT权限下执行以下脚本</span>
sh afterinstallbabirl.sh <span class="o">[</span>user name<span class="o">]</span>     <span class="c1">#需要ROOT权限</span>

<span class="c1">#其中这里的 [user name] 换成你的帐号用户名，例如我的用户名为wuhongyi</span>
<span class="c1"># sh afterinstallbabirl.sh wuhongyi</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="babicon">
<h2>初始化babicon<a class="headerlink" href="#babicon" title="永久链接至标题">¶</a></h2>
<p>执行 DAQConfig 中的 StartDAQ.sh 开启进程</p>
<p><strong>运行babicon(安装后第一次需输入以下初始化)</strong></p>
<p>新打开一个终端，然后输入</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>babicon
</pre></div>
</div>
<p>回车之后将看到以下界面</p>
<img alt="_images/babicon.png" src="_images/babicon.png" />
<p>以下进行基本的变量设置</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>seteflist <span class="m">10</span> add localhost localhost
sethdlist <span class="m">0</span> path /home/wuhongyi/data    <span class="c1">#这里为数据存储路径</span>
setclinfo <span class="m">0</span> add localhost  <span class="c1">#localhost为本机器</span>
setclinfo <span class="m">0</span> id  <span class="m">0</span>

<span class="c1">#如果设置给远程电脑</span>
setclinfo <span class="m">0</span> add <span class="o">[</span>ip<span class="o">]</span>   <span class="c1">#[ip] 为接收端电脑IP</span>
setclinfo <span class="m">0</span> id  <span class="m">0</span>
</pre></div>
</div>
<img alt="_images/babicon_setting.png" src="_images/babicon_setting.png" />
</div>
<hr class="docutils" />
<div class="section" id="id4">
<h2>防火墙设置<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p>将共享数据发送到 Online 电脑，需要做以下设置或者关闭防火墙</p>
<p>对Scientific Linux 6，终端 ROOT 权限下输入 <strong>setup</strong> ，选择 <strong>防火墙配置</strong> ，去掉 <strong>启用</strong> 。
对cientific Linux 7，ROOT 权限下终端输入以下信息关闭 firewall</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl stop firewalld.service <span class="c1">#停止firewall</span>
systemctl disable firewalld.service <span class="c1">#禁止firewall开机启动</span>
firewall-cmd --state <span class="c1">#查看默认防火墙状态（关闭后显示notrunning，开启后显示running）</span>
</pre></div>
</div>
<p>如果机器不联网，可以不需要开启以下 iptables 防火墙，反正不会被黑</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#在 /etc/sysconfig/iptables 添加以下一行（不能放到最后一行，其中IP替换为发送DAQ电脑的IP）</span>
-A INPUT -p udp -m state --state NEW -m udp --dport <span class="m">17500</span>:17510 -s <span class="m">222</span>.29.111.201 -j ACCEPT
</pre></div>
</div>
<p>之后在 ROOT 权限下执行以下命令</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl restart iptables.service <span class="c1">#最后重启防火墙使配置生效</span>
systemctl <span class="nb">enable</span> iptables.service <span class="c1">#设置防火墙开机启动</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Firmware.html" class="btn btn-neutral float-right" title="固件要求" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="README.html" class="btn btn-neutral float-left" title="简介" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Hongyi Wu(吴鸿毅)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>