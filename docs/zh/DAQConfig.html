

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>DAQConfig &mdash; VMEDAQ 20220904 文档</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="httponline" href="httponline.html" />
    <link rel="prev" title="cutpedestal" href="cutpedo.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> VMEDAQ
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">简介</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">简介</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">安装</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="INSTALL.html">软件安装</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">固件</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Firmware.html">固件要求</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">配置</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Setting.html">获取配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="anaroot.html">anaroot</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkcnt.html">checkcnt</a></li>
<li class="toctree-l1"><a class="reference internal" href="cutpedo.html">cutpedestal</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DAQConfig</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#babies-bbmodules-h">babies/bbmodules.h</a></li>
<li class="toctree-l2"><a class="reference internal" href="#babies-start-c">babies/start.c</a></li>
<li class="toctree-l2"><a class="reference internal" href="#babies-evt-c">babies/evt.c</a></li>
<li class="toctree-l2"><a class="reference internal" href="#babies-stop-c">babies/stop.c</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cmdvme-cmdvme-c">cmdvme/cmdvme.c</a></li>
<li class="toctree-l2"><a class="reference internal" href="#init-daqinitrc-sh">init/daqinitrc.sh</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="httponline.html">httponline</a></li>
<li class="toctree-l1"><a class="reference internal" href="online.html">online</a></li>
<li class="toctree-l1"><a class="reference internal" href="r2root.html">r2root</a></li>
<li class="toctree-l1"><a class="reference internal" href="statistics.html">statistics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">可编程逻辑</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="DT5495.html">基于可编程逻辑模块的触发系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="DT5495INSTALL.html">网页控制界面的安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="DT5495GUI.html">网页控制界面</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VMEDAQ</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>DAQConfig</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/DAQConfig.rst.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="daqconfig">
<h1>DAQConfig<a class="headerlink" href="#daqconfig" title="永久链接至标题">¶</a></h1>
<p>首先修改 <strong>StartDAQ.sh/StopDAQ.sh</strong> 两个文件，将文件内的 <em>wuhongyi</em> 替换成当前 LINUX 的用户名。然后修改 bbcaenvme 文件夹下 babies、init 文件夹内文件。</p>
<p>修改文件之前，我们需要先理解硬件地址与 GEO 编号。每个插件模块侧面都有四个拨盘，每个拨盘代表一个 16 进制位，例如，当四个拨盘从左到右分别为 1，2，3，4 时，表示其硬件地址为 0x1234。控制器与模块的通讯依靠该硬件地址来寻址，每个控制器下的模块地址应该具有唯一性。同时，我们可以通过软件对每个模块设置一个 GEO 编号，该模块输出数据中都会带有该 GEO 标记，方便我们对数据进行解码。GEO 编号范围为 0-31。</p>
<p>这里我们对硬件地址设置进行如下约定（当然以下约定不是强制要求，用户可以任意修改），</p>
<ul class="simple">
<li><p>v7xx 模块硬件地址从 0x1000 开始，然后 0x1001，有多少个模块就依次往后设置。</p></li>
<li><p>MADC32 硬件地址从 0x2000 开始，然后 0x2001，有多少个模块就依次往后设置。</p></li>
<li><p>v1x90 硬件地址从 0x4000 开始，然后 0x4001，有多少个模块就依次往后设置。</p></li>
<li><p>v830 模块硬件地址从 0x5000 开始，然后 0x5001，有多少个模块就依次往后设置。</p></li>
</ul>
<p>这里我们对 GEO 地址设置进行如下约定（当然以下约定不是强制要求，用户可以任意修改），</p>
<ul class="simple">
<li><p>一般 v830 使用 1-2 个模块而已，因此 GEO 编号 30/31 我们预留给 v830。第一个 v830 的 GEO 为 30，第二个 v830 的 GEO 为 31。</p></li>
<li><p>实验中一般 v7xx 和 MADC32 模块使用较多，如果每种模块均不超过 10 个的话，我们默认 0-9 预留给 v7xx，10-19 预留给 MADC32。如果某种模块超过 10 个话，那么 v7xx 和 MADC32 的 GEO 按照 0-19 的编号依次往下进行分配。</p></li>
<li><p>实验中 v1x90 模块的使用数量一般不会超过 5 个，这里我们为 v1x90 预留 20-24，编号从 20 开始依次往后进行分配。</p></li>
<li><p>剩余的 GEO 编号 25-29 进行机动使用。</p></li>
</ul>
<p><strong>整个 DAQ 的程序配置中，需要在文件 babies/bbmodules.h 中进行硬件地址设置。然后还需对文件夹 init 内的文件进行硬件地址和 GEO 的设置。</strong></p>
<section id="babies-bbmodules-h">
<h2>babies/bbmodules.h<a class="headerlink" href="#babies-bbmodules-h" title="永久链接至标题">¶</a></h2>
<p>修改 ADCADDR、MADCADDR、V1x90ADDR、SCAADDR 使之与硬件地址匹配（可以多余设置，不可少设置）。其它不要修改。</p>
<p>这里我们按照之前的约定，V7xx 硬件地址从 0x1000 开始编号，用 ADC[x]ADDR 来表示不同模块。MADC32 硬件地址从 0x2000 开始编号，用 MADC[x]ADDR 来表示不同模块。V1x90 硬件地址从 0x4000 开始编号，用 V1x90ADDR[x] 来表示不同模块。 V830 硬件地址从 0x5000 开始编号，用 SCAADDR[x] 来表示不同模块。（其中 [x] 代表不同的数字）</p>
<p><strong>如果您依照我们的约定来设置，则不需要修改本文件。</strong></p>
<p>如果您使用控制器V1718，则需要注释以下代码。否则开启以下代码</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
<span class="c1">// 以下部分用户需要修改</span>

<span class="cp">#define V2718   </span><span class="c1">//如果使用 V1718 则注释本行</span>

<span class="c1">// 以上部分用户需要修改</span>
<span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
</pre></div>
</div>
<p>如果您使用软件 busy 模式时，则开启以下代码行，如果您使用硬件 busy 模式时，则注释掉以下行代码。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
<span class="c1">// 以下部分用户需要修改</span>

<span class="cp">#define SOFTWAREBUSY</span>

<span class="c1">// 以上部分用户需要修改</span>
<span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
</pre></div>
</div>
<p>如果您使用常规的busy模式，且需要多个机箱同步运行，则开启以下代码，否则注释掉</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
<span class="c1">// 以下部分用户需要修改</span>

<span class="cp">#define SOFTWAREBUSYMULTICRATE</span>

<span class="c1">// 以上部分用户需要修改</span>
<span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
</pre></div>
</div>
<p>选择合适的插件类型作为 INTERRUPT 源，以下4行代码仅能开启一个。选择的依据是系统中的模块在一个事件中，谁最后完成数据的 MEB 写入，这样能够避免有些模块已经开始读取数据，而一些模块数据还未转换结束。当有 v7xx 模块时，默认选择该类型模块，如果系统有 MADC32 时，需要考虑读取它之前是否完成数据的转换。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
<span class="c1">// 以下部分用户需要修改</span>

<span class="cp">#define V7XXINTERRUPT</span>
<span class="c1">// #define SCAINTERRUPT</span>
<span class="c1">// #define MADC32INTERRUPT</span>
<span class="c1">// #define V1X90INTERRUPT</span>

<span class="c1">// 以上部分用户需要修改</span>
<span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
</pre></div>
</div>
</section>
<section id="babies-start-c">
<h2>babies/start.c<a class="headerlink" href="#babies-start-c" title="永久链接至标题">¶</a></h2>
<p><strong>根据文件内提示设置，有该类型插件则开启对应代码。其它不要修改。</strong></p>
<p><strong>V830</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
<span class="c1">// 以下部分用户需要修改</span>

<span class="c1">// 有 V830 插件</span>
<span class="n">v830_clear_all</span><span class="p">(</span><span class="n">SCAADDR0</span><span class="p">);</span><span class="w"></span>

<span class="c1">// 以上部分用户需要修改</span>
<span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
</pre></div>
</div>
<p>用户需要修改以上代码段，如果您不使用 V830 模块，则注释掉以上区域的代码。</p>
<p>如果您使用一个 V830 模块，则添加代码：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">v830_clear_all</span><span class="p">(</span><span class="n">SCAADDR0</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>如果您使用两个 V830 模块，则添加代码：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">v830_clear_all</span><span class="p">(</span><span class="n">SCAADDR0</span><span class="p">);</span><span class="w"></span>
<span class="n">v830_clear_all</span><span class="p">(</span><span class="n">SCAADDR1</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p><strong>V7xx</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
<span class="c1">// 以下部分用户需要修改</span>

<span class="c1">// 有 V7xx 插件</span>
<span class="c1">// 每个插件单独设置</span>
<span class="n">v7xx_rst_counter</span><span class="p">(</span><span class="n">ADC0ADDR</span><span class="p">);</span><span class="w"></span>
<span class="n">v7xx_rst_counter</span><span class="p">(</span><span class="n">ADC1ADDR</span><span class="p">);</span><span class="w"></span>
<span class="n">v7xx_rst_counter</span><span class="p">(</span><span class="n">ADC2ADDR</span><span class="p">);</span><span class="w"></span>
<span class="c1">// v7xx_rst_counter(ADC3ADDR);</span>
<span class="c1">// v7xx_rst_counter(ADC4ADDR);</span>
<span class="c1">// v7xx_rst_counter(ADC5ADDR);</span>
<span class="c1">// v7xx_rst_counter(ADC6ADDR);</span>
<span class="c1">// v7xx_rst_counter(ADC7ADDR);</span>

<span class="n">v7xx_clear</span><span class="p">(</span><span class="n">ADC0ADDR</span><span class="p">);</span><span class="w"></span>
<span class="n">v7xx_clear</span><span class="p">(</span><span class="n">ADC1ADDR</span><span class="p">);</span><span class="w"></span>
<span class="n">v7xx_clear</span><span class="p">(</span><span class="n">ADC2ADDR</span><span class="p">);</span><span class="w"></span>
<span class="c1">// v7xx_clear(ADC3ADDR);</span>
<span class="c1">// v7xx_clear(ADC4ADDR);</span>
<span class="c1">// v7xx_clear(ADC5ADDR);</span>
<span class="c1">// v7xx_clear(ADC6ADDR);</span>
<span class="c1">// v7xx_clear(ADC7ADDR);</span>

<span class="c1">// 以上部分用户需要修改</span>
<span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
</pre></div>
</div>
<p>用户需要修改以上代码段，如果您不使用 V7xx 模块，则注释掉以上区域的代码。</p>
<p>如果您使用一个 V7xx 模块，则添加代码：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">v7xx_rst_counter</span><span class="p">(</span><span class="n">ADC0ADDR</span><span class="p">);</span><span class="w"></span>
<span class="n">v7xx_clear</span><span class="p">(</span><span class="n">ADC0ADDR</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>如果您使用两个 V7xx 模块，则添加代码：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">v7xx_rst_counter</span><span class="p">(</span><span class="n">ADC0ADDR</span><span class="p">);</span><span class="w"></span>
<span class="n">v7xx_rst_counter</span><span class="p">(</span><span class="n">ADC1ADDR</span><span class="p">);</span><span class="w"></span>
<span class="n">v7xx_clear</span><span class="p">(</span><span class="n">ADC0ADDR</span><span class="p">);</span><span class="w"></span>
<span class="n">v7xx_clear</span><span class="p">(</span><span class="n">ADC1ADDR</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>使用更多 V7xx 则依次类推。</p>
<p><strong>V1x90</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
<span class="c1">// 以下部分用户需要修改</span>

<span class="c1">// 有 V1190/V1290 插件</span>
<span class="c1">// 每个插件单独clear</span>
<span class="c1">// v1190_clear(V1x90ADDR0);</span>
<span class="c1">// v1290_clear(V1x90ADDR1);</span>

<span class="n">v1190_clear</span><span class="p">(</span><span class="n">V1x90ADDR0</span><span class="p">);</span><span class="w"></span>
<span class="n">v1190_clear</span><span class="p">(</span><span class="n">V1x90ADDR1</span><span class="p">);</span><span class="w"></span>
<span class="c1">// v1290_clear(V1x90ADDR0);</span>
<span class="c1">// v1290_clear(V1x90ADDR1);</span>

<span class="c1">// 以上部分用户需要修改</span>
<span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
</pre></div>
</div>
<p>用户需要修改以上代码段，如果您不使用 V1x90 模块，则注释掉以上区域的代码。</p>
<p>如果您只使用一个 V1190 模块，则添加代码：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">v1190_clear</span><span class="p">(</span><span class="n">V1x90ADDR0</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>如果您只使用两个 V1190 模块，则添加代码：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">v1190_clear</span><span class="p">(</span><span class="n">V1x90ADDR0</span><span class="p">);</span><span class="w"></span>
<span class="n">v1190_clear</span><span class="p">(</span><span class="n">V1x90ADDR1</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>如果您使用一个 V1190，一个 V1290，则添加代码：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">v1190_clear</span><span class="p">(</span><span class="n">V1x90ADDR0</span><span class="p">);</span><span class="w"></span>
<span class="n">v1290_clear</span><span class="p">(</span><span class="n">V1x90ADDR1</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>更多模块使用的组合，请以此类推。</p>
<p><strong>MADC32</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
<span class="c1">// 以下部分用户需要修改</span>

<span class="c1">// 有 MADC32 插件</span>
<span class="n">madc32_mclear</span><span class="p">(</span><span class="n">MSTMDCADDR</span><span class="p">);</span><span class="w"></span>
<span class="n">madc32_mirq_level</span><span class="p">(</span><span class="n">MSTMDCADDR</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="n">madc32_mreset_ctra_counters</span><span class="p">(</span><span class="n">MSTMDCADDR</span><span class="p">);</span><span class="w"></span>
<span class="n">madc32_mfifo_reset</span><span class="p">(</span><span class="n">MSTMDCADDR</span><span class="p">);</span><span class="w"></span>
<span class="n">madc32_mstart_acq</span><span class="p">(</span><span class="n">MSTMDCADDR</span><span class="p">);</span><span class="w"></span>

<span class="c1">// 以上部分用户需要修改</span>
<span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
</pre></div>
</div>
<p>用户需要修改以上代码段，如果您不使用 MADC32 模块，则注释掉以上区域的代码。如果您使用了 MADC32 模块，不管使用了多少个模块，只需要开启以上代码即可对所有的模块完成初始化。</p>
</section>
<section id="babies-evt-c">
<h2>babies/evt.c<a class="headerlink" href="#babies-evt-c" title="永久链接至标题">¶</a></h2>
<p><strong>根据文件内提示设置。其它不要修改。</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
<span class="c1">// 以下部分用户需要修改</span>

<span class="c1">// 软件BUSY模式下6036-&gt;0x1不需要以下清除，6036-&gt;0x3需要以下清除，6036-&gt;0x0需要以下清除</span>
<span class="c1">// 硬件BUSY模式下只能采用6036-&gt;0x3，需要以下清除</span>

<span class="c1">// 有 MADC32 插件</span>
<span class="n">madc32_mclear</span><span class="p">(</span><span class="n">MSTMDCADDR</span><span class="p">);</span><span class="w"></span>

<span class="c1">// 以上部分用户需要修改</span>
<span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
</pre></div>
</div>
<p>用户需要修改以上代码段，如果您不使用 MADC32 模块，则注释掉以上区域的代码。如果您使用了 MADC32 模块，不管使用了多少个模块，只需要开启以上代码即可对所有的模块完成清除。</p>
<p>当然，在软件 busy 模式下，对每个模块的寄存器进行相应的寄存器配置，可以不用以上清除指令自动进行清除，此时每个事件能够节约 20 us 左右的时间，该方案建议对 DAQ 比较熟悉的用户使用。</p>
<p>当系统中有两个及以上模块时。采用 CBLT 方式读取数据，这是最高效的数据读取方式。但是当系统中只有一个模块时，则注释掉 CBLT 的数据读取，开启对应插件的读取。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
<span class="c1">// 以下部分用户需要修改</span>

<span class="c1">// Read data</span>
<span class="n">babies_init_segment</span><span class="p">(</span><span class="n">MKSEGID</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">PLAQ</span><span class="p">,</span><span class="w"> </span><span class="n">CBLT</span><span class="p">));</span><span class="w"></span>
<span class="cp">#ifdef V7XXINTERRUPT</span>
<span class="n">v7xx_dmasegdata</span><span class="p">(</span><span class="n">MSTTDCADDR</span><span class="p">,</span><span class="w"> </span><span class="mi">4000</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="cp">#ifdef SCAINTERRUPT</span>
<span class="n">usleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"></span>
<span class="n">v830_dmasegdata</span><span class="p">(</span><span class="n">MSTTDCADDR</span><span class="p">,</span><span class="w"> </span><span class="mi">4000</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="cp">#ifdef V1X90INTERRUPT</span>
<span class="n">v1190_dmasegdata</span><span class="p">(</span><span class="n">MSTTDCADDR</span><span class="p">,</span><span class="w"> </span><span class="mi">4000</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="cp">#ifdef MADC32INTERRUPT</span>
<span class="n">madc32_dmasegdata</span><span class="p">(</span><span class="n">MSTTDCADDR</span><span class="p">,</span><span class="w"> </span><span class="mi">4000</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="n">babies_end_segment</span><span class="p">();</span><span class="w"></span>


<span class="c1">// 插件</span>
<span class="c1">// babies_init_segment(MKSEGID(0, 0, PLAQ, V785));</span>
<span class="c1">// v7xx_dmasegdata(ADC0ADDR, 34);</span>
<span class="c1">// babies_end_segment();</span>

<span class="c1">// babies_init_segment(MKSEGID(0, 0, PLAQ, V830));</span>
<span class="c1">// v830_dmasegdata(SCAADDR0, 34);</span>
<span class="c1">// babies_end_segment();</span>

<span class="c1">// babies_init_segment(MKSEGID(0, 0, PLAQ, V1190));//V1290</span>
<span class="c1">// v1190_dmasegdata(V1x90ADDR0, 1000);</span>
<span class="c1">// babies_end_segment();</span>

<span class="c1">// babies_init_segment(MKSEGID(0, 0, PLAQ, MADC));</span>
<span class="c1">// madc32_dmasegdata(MADC0ADDR, 34);</span>
<span class="c1">// babies_end_segment();</span>

<span class="c1">// 以上部分用户需要修改</span>
<span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
</pre></div>
</div>
</section>
<section id="babies-stop-c">
<h2>babies/stop.c<a class="headerlink" href="#babies-stop-c" title="永久链接至标题">¶</a></h2>
<p><strong>根据文件内提示设置，有该类型插件则开启对应代码，开启对应类型 busy 代码。其它不要修改。</strong></p>
<p><strong>MADC32</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
<span class="c1">// 以下部分用户需要修改</span>

<span class="c1">// 有 MADC32 插件</span>
<span class="n">madc32_mstop_acq</span><span class="p">(</span><span class="n">MSTMDCADDR</span><span class="p">);</span><span class="w"></span>

<span class="c1">// 以上部分用户需要修改</span>
<span class="c1">//....oooOO0OOooo........oooOO0OOooo........oooOO0OOooo........oooOO0OOooo......</span>
</pre></div>
</div>
<p>用户需要修改以上代码段，如果您不使用 MADC32 模块，则注释掉以上区域的代码。如果您使用了 MADC32 模块，不管使用了多少个模块，只需要开启以上代码即可对所有的模块发送结束采集指令。</p>
</section>
<section id="cmdvme-cmdvme-c">
<h2>cmdvme/cmdvme.c<a class="headerlink" href="#cmdvme-cmdvme-c" title="永久链接至标题">¶</a></h2>
<p>如果使用控制器 V1718，则需要修改文件中以下代码。将 <em>V2718</em> 改为 <em>V1718</em> 即可。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="nc">board</span><span class="w"> </span><span class="n">bd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V2718</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>如果编译中出现以下类似的错误，</p>
<div class="highlight-txt notranslate"><div class="highlight"><pre><span></span>cmdvme.c:29:8: error: initialization of flexible array member in a nested context
29 |   {WR, &quot;-wr&quot;},
   |        ^~~~~
cmdvme.c:29:8: note: (near initialization for ‘chkmode[0]’)
</pre></div>
</div>
<p>则代码修改如下</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span> <span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">enum</span> <span class="nc">mode</span><span class="w"> </span><span class="n">md</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">mdchar</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span><span class="c1">//指定数组长度</span>
<span class="p">}</span><span class="n">stchkmode</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="init-daqinitrc-sh">
<h2>init/daqinitrc.sh<a class="headerlink" href="#init-daqinitrc-sh" title="永久链接至标题">¶</a></h2>
<p>修改该文件内对应脚本，使之与获取插件对应，用来初始化插件。</p>
<p><strong>重点是修改 cblt.hh 文件，对启用的插件设置CBLT ADDR 为 0xbb，其中 MADC 还得设置 MCST ADDR 为 0xdd。还得设置每一个插件在 CBLT 中的顺序，first、mid、last。至少得两个插件才能组成CBLT.</strong></p>
<p>init/daqinitrc.sh 文件包含以下内容：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

/bin/sh ./v830.sh
/bin/sh ./v7xx_all.sh
<span class="c1"># /bin/sh ./v7xx_thres.sh</span>
/bin/sh ./v1190_0.sh
/bin/sh ./v1190_1.sh
<span class="c1"># /bin/sh ./v1290.sh</span>
/bin/sh ./madcall.sh
<span class="c1"># /bin/sh ./madc_thres.sh</span>
/bin/sh ./cblt.sh
</pre></div>
</div>
<p>如果您使用了 V830 则开启以下代码，否则注释掉以下代码：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/bin/sh ./v830.sh
</pre></div>
</div>
<p><strong>待补充</strong></p>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="httponline.html" class="btn btn-neutral float-right" title="httponline" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="cutpedo.html" class="btn btn-neutral float-left" title="cutpedestal" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2022, Hongyi Wu(吴鸿毅).

    </p>
  </div>
    
    
    
    利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>